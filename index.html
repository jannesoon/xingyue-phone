<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>EPhone</title>
  <link rel="stylesheet" href="style.css">
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EPhone">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script src="https://unpkg.com/dexie/dist/dexie.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://phoebeboo.github.io/mewoooo/pp.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/streamsaver@2.0.6/StreamSaver.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
  <script src="script.js" defer="defer"></script>
</head>
<body>
  <div id="phone-screen">
    <div id="status-bar"> <span id="status-bar-time">12:00</span>
      <div id="status-bar-battery" class="battery-container"> <span class="battery-text">--%</span>
        <div class="battery-icon">
          <div class="battery-level"></div>
        </div>
      </div>
    </div>
    <div id="notification-bar"><img id="notification-avatar" src="">
      <div id="notification-content">
        <div class="name"></div>
        <div class="message"></div>
      </div>
    </div>
    <div id="home-screen" class="screen active">
      <div id="home-screen-pages-container">
        <div id="home-screen-pages">
          <div class="home-screen-page">
            <div id="main-content-area">
              <div id="profile-widget"> <img id="profile-banner-img" src="https://i.imgur.com/1n3a43H.jpeg" class="editable-image">
                <div class="profile-avatar-container"> <img id="profile-avatar-img" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" class="editable-image"> </div>
                <div class="profile-info">
                  <p id="profile-username" class="editable-text">@ insonneve 🪦</p>
                  <p id="profile-sub-username" class="editable-text">@ insonneve</p>
                  <p id="profile-bio" class="editable-text">你好像过得很好 迫不及待的抹去我存在的痕迹</p>
                  <p id="profile-location" class="editable-text"> <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5-2.5-1.12 2.5-2.5 2.5z"></path>
                    </svg> <span>北海道</span> </p>
                </div>
              </div>
              <div id="desktop-layout">
                <div id="desktop-widget-column">
                  <div class="desktop-widget text-only">
                    <p id="widget-text-1" class="editable-text">Be fearless in pursuit of happiness</p>
                  </div>
                  <div class="desktop-widget icon-left"> <img id="widget-avatar-1" src="https://i.imgur.com/1n3a43H.jpeg" class="editable-image"> <span id="widget-text-2" class="editable-text">Dare to be different</span> </div>
                  <div class="desktop-widget icon-right"> <span id="widget-text-3" class="editable-text">* Keep your spirit free</span> <img id="widget-avatar-2" src="https://i.imgur.com/5A0tE9a.jpeg" class="editable-image"> </div>
                </div>
                <div id="desktop-app-container">
                  <div class="desktop-app-icon" onclick="showScreen('chat-list-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-qq" src="https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg" alt="QQ"></div> <span class="label"data-lang-key="homeAppQQ">QQ</span>
                  </div>
                  <div class="desktop-app-icon" onclick="showScreen('world-book-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-world-book" src="https://i.postimg.cc/HWf1JKzn/IMG-6435.jpg" alt="世界书"></div> <span class="label"data-lang-key="homeAppWorldBook">世界书</span>
                  </div>
                  <div class="desktop-app-icon" onclick="showScreen('wallpaper-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-wallpaper" src="https://i.postimg.cc/T1j03pQr/IMG-6440.jpg" alt="外观设置"></div> <span class="label"data-lang-key="homeAppAppearance">外观设置</span>
                  </div>
                  <div class="desktop-app-icon" onclick="openRenderingRulesScreen()">
                    <div class="icon-bg-desktop"><img id="icon-img-renderer" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg" alt="渲染器"></div> <span class="label"data-lang-key="homeAppRenderer">渲染器</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="home-screen-page">
            <div class="polaroid-widget-container">
              <div class="polaroid-photos">
                <div class="polaroid-photo" style="transform: rotate(-6deg);" onclick="handleWidgetImageChange('polaroid-img-1')"> <img id="polaroid-img-1" src="https://i.imgur.com/Bv63o3h.jpg" alt="Photo 1"> </div>
                <div class="polaroid-photo" style="transform: rotate(2deg);" onclick="handleWidgetImageChange('polaroid-img-2')"> <img id="polaroid-img-2" src="https://i.imgur.com/GzPzBfF.jpg" alt="Photo 2"> </div>
                <div class="polaroid-photo" style="transform: rotate(5deg);" onclick="handleWidgetImageChange('polaroid-img-3')"> <img id="polaroid-img-3" src="https://i.imgur.com/Wp72cEM.jpg" alt="Photo 3"> </div>
              </div>
            </div>
            <div id="page-2-app-container">
              <div class="large-widget" onclick="handleWidgetImageChange('large-widget-img')"> <img class="large-widget-img" id="large-widget-img" src="https://i.imgur.com/Bv63o3h.jpg" alt="Colorful Widget"> </div>
              <div class="app-subgrid">
                <div class="small-widget" onclick="openPresetScreen()">
                  <div class="small-widget-icon-wrapper"> <img class="small-widget-img" id="icon-img-preset" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg" alt="预设"> </div> <span class="small-widget-label"data-lang-key="homeAppPreset">预设</span>
                </div>
                <div class="small-widget" onclick="showScreen('tutorial-screen')">
                  <div class="small-widget-icon-wrapper"> <img class="small-widget-img" id="icon-img-tutorial" src="https://i.postimg.cc/d10GjC4g/IMG-7302.jpg" alt="教程"> </div> <span class="small-widget-label"data-lang-key="homeAppTutorial">教程</span>
                </div>
                <div class="small-widget" onclick="openWerewolfLobby('global')">
                  <div class="small-widget-icon-wrapper"> <img class="small-widget-img" id="icon-img-werewolf" src="https://i.postimg.cc/k401K5g7/IMG-7304.jpg" alt="狼人杀"> </div> <span class="small-widget-label"data-lang-key="homeAppWerewolf">狼人杀</span>
                </div>
                <div class="small-widget" onclick="showScreen('x-social-screen')">
                  <div class="small-widget-icon-wrapper"> <img class="small-widget-img" id="icon-img-x" src="https://i.postimg.cc/Y9d3BztC/1.png" alt="X"> </div> <span class="small-widget-label"data-lang-key="homeAppX">X</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="home-screen-pagination">
        <div class="pagination-dot active"></div>
        <div class="pagination-dot"></div>
      </div>
      <div id="desktop-dock">
        <div class="desktop-app-icon" onclick="showScreen('api-settings-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-api-settings" src="https://i.postimg.cc/MK8rJ8t7/IMG-6438.jpg" alt="API设置"></div> <span class="label"data-lang-key="homeAppApiSettings">API设置</span>
        </div>
        <div class="desktop-app-icon" onclick="showScreen('font-settings-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-font" src="https://i.postimg.cc/pXxk1JXk/IMG-6442.jpg" alt="字体"></div> <span class="label"data-lang-key="homeAppFont">字体</span>
        </div>
        <div class="desktop-app-icon" onclick="openCharacterSelector()">
          <div class="icon-bg-desktop"><img id="icon-img-char-phone" src="https://i.postimg.cc/pXj9h20L/IMG-7275.jpg" alt="Cphone"></div> <span class="label"data-lang-key="homeAppCPhone">Cphone</span>
        </div>
      </div>
    </div>
    <div id="character-selection-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="cphoneTitleSelect">选择一部手机</span> <span style="width: 30px;"></span> </div>
      <div id="character-grid" class="list-container"> </div>
    </div>
    <div id="character-phone-screen" class="screen">
      <div id="char-home-screen" class="char-screen active">
        <div id="char-clock-container">
          <div id="char-main-time">12:00</div>
          <div id="char-main-date">1月1日 星期一</div>
        </div>
        <div id="char-app-grid">
          <div class="app-row">
            <div class="app-icon" onclick="openCharApp('qq')">
              <div class="icon-bg"><img id="cphone-icon-img-qq" src=""></div><span class="label">QQ</span>
            </div>
            <div class="app-icon" onclick="openCharApp('album')">
              <div class="icon-bg"><img id="cphone-icon-img-album" src=""></div><span class="label" data-lang-key="cphoneAppAlbum">相册</span>
            </div>
            <div class="app-icon" onclick="openCharApp('browser')">
              <div class="icon-bg"><img id="cphone-icon-img-browser" src=""></div><span class="label" data-lang-key="cphoneAppBrowser">浏览器</span>
            </div>
            <div class="app-icon" onclick="openCharApp('taobao')">
              <div class="icon-bg"><img id="cphone-icon-img-taobao" src=""></div><span class="label"data-lang-key="cphoneAppTaobao">淘宝</span>
            </div>
          </div>
          <div class="app-row">
            <div class="app-icon" onclick="openCharApp('memo')">
              <div class="icon-bg"><img id="cphone-icon-img-memo" src=""></div><span class="label"data-lang-key="cphoneAppMemo">备忘录</span>
            </div>
            <div class="app-icon" onclick="openCharApp('diary')">
              <div class="icon-bg"><img id="cphone-icon-img-diary" src=""></div><span class="label"data-lang-key="cphoneAppDiary">日记</span>
            </div>
            <div class="app-icon" onclick="openCharApp('amap')">
              <div class="icon-bg"><img id="cphone-icon-img-amap" src=""></div><span class="label"data-lang-key="cphoneAppAmap">高德地图</span>
            </div>
            <div class="app-icon" onclick="openCharApp('usage')">
              <div class="icon-bg"><img id="cphone-icon-img-usage" src=""></div><span class="label"data-lang-key="cphoneAppUsage">App记录</span>
            </div>
          </div>
          <div class="app-row">
            <div class="app-icon" onclick="openCharApp('music')">
              <div class="icon-bg"><img id="cphone-icon-img-music" src=""></div><span class="label"data-lang-key="cphoneAppMusic">网易云</span>
            </div>
            <div class="app-icon" onclick="switchToMyPhone()">
              <div class="icon-bg"><img id="cphone-icon-img-ephone" src=""></div><span class="label"data-lang-key="cphoneAppEphone">Ephone</span>
            </div>
          </div>
        </div>
      </div>
      <div id="char-amap-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span>足迹</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-amap-btn" title="重新生成足迹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-amap-list" class="list-container"> </div>
      </div>
      <div id="char-qq-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span>QQ</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-qq-btn" title="重新生成"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-chat-list" class="list-container"></div>
      </div>
      <div id="char-qq-conversation-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-char-qq-list-btn">‹</span> <span id="char-conversation-partner-name"></span> <span style="width: 30px;"></span> </div>
        <div id="char-conversation-messages" class="list-container"> </div>
        <div id="char-conversation-input-area" style="padding: 8px; border-top: 1px solid var(--border-color); display: flex; gap: 8px; background-color: #f7f7f7;"> <input type="text" id="char-simulated-input" placeholder="这是模拟对话，无法发送消息" data-lang-key-placeholder="cphoneSimulatedChatPlaceholder"disabled
            style="flex-grow: 1; padding: 10px; border-radius: 6px; border: 1px solid #ddd; background: #eee;"> <button id="char-simulated-send-btn" style="padding: 0 20px; border: none; background-color: var(--accent-color); color: white; border-radius: 6px; font-weight: 500;">发送</button> </div>
      </div>
      <div id="char-album-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneAlbumTitle">TA的相册</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-album-btn" title="重新生成相册内容"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div class="list-container">
          <div id="char-album-grid"></div>
        </div>
      </div>
      <div id="char-browser-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneBrowserTitle">TA的浏览器历史</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-browser-btn" title="重新生成浏览记录"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-browser-history" class="list-container"> </div>
      </div>
      <div id="char-browser-article-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharScreen('char-browser-screen')">‹</span> <span id="char-article-title" style="max-width: 70%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">文章</span>
          <div class="header-actions"> <span class="action-btn" id="favorite-article-btn" title="收藏"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> </div>
        </div>
        <div id="char-article-content" class="list-container" style="padding: 20px; font-size: 16px; line-height: 1.8; overflow-y: auto;"></div>
      </div>
      <div id="char-taobao-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneTaobaoTitle">TA的淘宝订单</span>
          <div class="header-actions"> <span class="action-btn" id="char-wallet-btn" title="查看钱包" onclick="openCharWallet()"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M20 12V8H4v4"></path>
                <path d="M4 8V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v2"></path>
                <path d="M18 12v6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-6"></path>
              </svg> </span> <span class="action-btn" id="regenerate-char-taobao-btn" title="重新生成购买记录"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-product-grid" class="list-container"></div>
      </div>
      <div id="char-wallet-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-wallet-back-btn">‹</span> <span data-lang-key="cphoneWalletTitle">钱包</span> <span style="width: 30px;"></span> </div>
        <div id="char-wallet-content" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
      </div>
      <div id="char-memo-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneMemoTitle">备忘录</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-memo-btn" title="重新生成备忘录"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> <span class="action-btn" id="add-char-memo-btn">+</span> </div>
        </div>
        <div id="char-memo-list" class="list-container" style="padding: 10px;"></div>
      </div>
      <div id="char-memo-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-memo-detail-back-btn">‹</span> <span id="char-memo-detail-title"></span>
          <div class="header-actions"> <span class="action-btn" id="favorite-memo-btn" title="收藏"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> </div>
        </div>
        <div class="form-container" style="padding: 0;"> <textarea id="char-memo-detail-content" readonly></textarea> </div>
      </div>
      <div id="char-diary-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneDiaryTitle">日记</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-diary-btn" title="重新生成日记本"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> <span class="action-btn" id="add-char-diary-btn">+</span> </div>
        </div>
        <div id="char-diary-list" class="list-container"></div>
      </div>
      <div id="char-diary-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-diary-detail-back-btn">‹ </span> <span id="char-diary-detail-title"></span>
          <div class="header-actions"> <span class="action-btn" id="favorite-diary-btn" title="收藏"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> </div>
        </div>
        <div id="char-diary-detail-content-wrapper" class="list-container">
          <div id="char-diary-detail-content"> </div>
        </div>
      </div>
      <div id="char-usage-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneUsageTitle">App使用记录</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-usage-btn" title="重新生成记录"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-usage-list" class="list-container"> </div>
      </div>
      <div id="char-qq-transcript-modal" class="modal">
        <div class="modal-content" style="height: 80%;">
          <div class="modal-header"> <span id="transcript-modal-char-name"></span> </div>
          <div class="modal-body" id="transcript-modal-body" style="background-color: #f0f2f5; padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
          <div class="modal-footer"> <button class="save" id="close-transcript-modal-btn" style="width:100%;">关闭</button> </div>
        </div>
      </div>
      <div id="char-music-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneMusicTitle">TA的歌单</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-music-btn" title="重新生成歌单"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-music-list" class="list-container"> </div>
      </div>
      <div id="char-music-player-modal" class="modal">
        <div class="modal-content">
          <div class="char-player-body">
            <div class="char-player-song-info">
              <p id="char-music-player-title">歌曲名称</p>
              <p id="char-music-artist">歌手</p>
            </div>
            <div id="char-vinyl-container"> <img id="char-music-cover" src=""> </div>
            <div id="char-music-lyrics"> </div>
            <div class="char-player-footer">
              <div class="char-player-progress-bar-container"> <span id="char-music-current-time" class="time-display">0:00</span>
                <div id="char-music-progress-bar" class="char-player-progress-bar">
                  <div id="char-music-progress-fill"></div>
                </div> <span id="char-music-total-time" class="time-display">0:00</span>
              </div>
              <div class="char-player-controls"> <button id="char-music-prev-btn" class="control-btn"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path>
                  </svg> </button> <button id="char-music-play-pause-btn" class="control-btn play"> <svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor">
                    <path d="M8 5v14l11-7z"></path>
                  </svg> </button> <button id="char-music-next-btn" class="control-btn"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M16 6h2v12h-2zm-3.5 6l-8.5 6V6z"></path>
                  </svg> </button> <button id="char-music-mode-btn" class="control-btn mode">顺序</button> </div>
            </div>
          </div> <button id="close-char-music-player-btn" class="char-player-close-btn">×</button>
        </div>
      </div>
    </div>
    <div id="world-book-screen" class="screen">
      <div class="header">
        <div class="header-left-actions"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span class="action-btn" id="import-world-book-btn" title="导入世界书"data-lang-key-title="worldBookImportTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> </span> <span class="action-btn" id="export-world-book-btn" title="导出世界书"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg> </span> </div> <span data-lang-key="worldBookTitle">世界书</span>
        <div class="header-actions"> <span class="action-btn" id="manage-world-book-categories-btn" title="管理分类"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg> </span> <span class="action-btn" id="add-world-book-btn">+</span> </div>
      </div>
      <div id="world-book-tabs"></div>
      <div id="world-book-content-container"></div>
    </div>
    <div id="world-book-editor-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('world-book-screen')">‹</span> <span id="world-book-editor-title"data-lang-key="worldBookEditorTitle"data-lang-key="edit">编辑世界书</span> <span class="save-btn" id="save-world-book-btn"data-lang-key="save">保存</span> </div>
      <div class="form-container">
        <div class="form-group"> <label for="world-book-name-input"data-lang-key="worldBookNameLabel">书名</label> <input type="text" id="world-book-name-input" placeholder="请输入世界书的名称..."data-lang-key-placeholder="worldBookNamePlaceholder"> </div>
        <div class="form-group"> <label for="world-book-category-select"data-lang-key="worldBookCategoryLabel">分类</label> <select id="world-book-category-select"></select> </div>
        <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label data-lang-key="worldBookEntriesLabel">内容条目</label>
          <div id="world-book-entries-container" style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding: 5px; flex-grow: 1;"> </div>
        </div> <button id="add-world-book-entry-btn" class="form-button form-button-secondary"data-lang-key="worldBookAddEntryBtn"> [+] 添加新条目 </button>
      </div>
    </div>
    <div id="preset-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="presetTitle">预设</span>
        <div class="header-actions"> <span class="action-btn" id="import-preset-btn" title="导入预设文件" data-lang-key-title="presetImportTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> </span> <span class="action-btn" id="manage-preset-categories-btn" title="管理分类"data-lang-key-title="presetManageCategoriesTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg> </span> <span class="action-btn" id="add-preset-btn">+</span> </div>
      </div>
      <div id="preset-tabs"></div>
      <div id="preset-content-container"></div>
    </div>
    <div id="tutorial-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="tutorialTitle">教程</span> <span style="width: 30px;"></span> </div>
      <div class="list-container" style="padding: 0; overflow: hidden;"> <iframe id="tutorial-iframe" src="tutorial.html" style="width: 100%; height: 100%; border: none;"></iframe> </div>
    </div>
    <div id="preset-editor-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('preset-screen')">‹</span> <span id="preset-editor-title"data-lang-key="presetEditorTitle">编辑预设</span> <span class="save-btn" id="save-preset-btn"data-lang-key="save">保存</span> </div>
      <div class="form-container">
        <div class="form-group"> <label for="preset-name-input"data-lang-key="presetNameLabel">预设名称</label> <input type="text" id="preset-name-input" placeholder="请输入预设的名称..."data-lang-key-placeholder="presetNamePlaceholder"> </div>
        <div class="form-group"> <label for="preset-category-select"data-lang-key="presetCategoryLabel">分类</label> <select id="preset-category-select"></select> </div>
        <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label data-lang-key="presetEntriesLabel">内容条目</label>
          <div id="preset-entries-container" style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding: 5px; flex-grow: 1;"> </div>
        </div> <button type="button" id="add-preset-entry-btn" class="form-button form-button-secondary"data-lang-key="presetAddEntryBtn"> [+] 添加新条目 </button>
      </div>
    </div>
    <div id="api-settings-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="apiSettingsTitle">API 设置</span> <span style="width: 30px;"></span> </div>
      <div class="form-container">
    <div class="form-group">
        <label for="language-select" data-lang-key="languageLabel">语言 (Language)</label>
        <select id="language-select">
            <option value="zh-CN">简体中文</option>
            <option value="en">English</option>
        </select>
    </div>
    <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiPresetManagement">API 预设管理</h3>
        <div class="form-group"> <label for="api-preset-select"data-lang-key="apiPresetSelectLabel">选择或切换预设</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="api-preset-select" style="flex-grow: 1;"></select> <button id="save-api-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button id="delete-api-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiPrimarySettings">主API设置 (用于聊天)</h3>
        <p style="font-size: 14px; color: #666; background-color: #f0f0f0; padding: 10px; border-radius: 8px;"> 提示: 若要使用“发送图片”功能, 请务必选择支持Vision(视觉)的模型, 如<code style="background-color: #e0e0e0; padding: 2px 4px; border-radius: 4px;">gpt-4o</code>或<code
            style="background-color: #e0e0e0; padding: 2px 4px; border-radius: 4px;">gpt-4-vision-preview</code>。 </p>
        <div class="form-group"> <label for="proxy-url"data-lang-key="apiProxyUrlLabel">反代地址 (不需要添加/v1噢~)</label> <input type="text" id="proxy-url" placeholder="例如: https://api.openai.com"> </div>
        <div class="form-group"> <label for="api-key"data-lang-key="apiKeyLabel">密钥 (API Key)</label> <input type="password" id="api-key" placeholder="sk-..."> </div>
        <div class="form-group"> <label for="model-select"data-lang-key="apiModelLabel">模型</label> <select id="model-select"></select> </div> <button class="form-button" id="fetch-models-btn"data-lang-key="apiFetchModelsBtn">拉取主模型</button>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiSecondarySettings">副API设置 (用于总结长期记忆)</h3>
        <p style="font-size: 14px; color: #666; background-color: #f0f0f0; padding: 10px; border-radius: 8px;"> 您可以在此配置一个独立的、可能成本更低的API，专门用于后台的长期记忆总结任务，以节省主API的费用。如果留空，将默认使用主API进行总结。 </p>
        <div class="form-group"> <label for="secondary-proxy-url"data-lang-key="apiSecondaryProxyUrlLabel">副反代地址</label> <input type="text" id="secondary-proxy-url" placeholder="例如: https://api.groq.com/openai"> </div>
        <div class="form-group"> <label for="secondary-api-key"data-lang-key="apiSecondaryKeyLabel">副密钥</label> <input type="password" id="secondary-api-key" placeholder="gsk_..."> </div>
        <div class="form-group"> <label for="secondary-model-select"data-lang-key="apiSecondaryModelLabel">副模型</label> <select id="secondary-model-select"></select> </div> <button class="form-button form-button-secondary" id="fetch-secondary-models-btn"data-lang-key="apiFetchSecondaryModelsBtn">拉取副模型</button>
        <div class="form-group"> <label for="api-temperature-slider">API 温度 (Temperature) <span id="api-temperature-value">0.8</span></label>
          <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 控制AI回复的随机性和创造性。值越高，回复越随机；值越低，回复越确定。建议范围 0.7-1.0。 </p> <input type="range" id="api-temperature-slider" min="0" max="2" step="0.1" value="0.8" style="width: 100%; margin-top: 8px;">
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiBgActivitySettings">后台活动设置</h3>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="background-activity-switch" style="margin-bottom: 0;"data-lang-key="apiEnableBgActivityLabel"> 启用后台角色活动 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 警告：此功能会显著增加API调用和费用！ </p>
          </label> <input type="checkbox" id="background-activity-switch" style="width: auto; height: 20px;"> </div>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;"> <label for="background-interval-input" style="margin-bottom: 0;"data-lang-key="apiBgIntervalLabel"> 后台活动检测间隔 (秒) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 建议值
              60-300。值越大，费用越低，但角色反应越慢。 </p> </label> <input type="number" id="background-interval-input" min="30" value="60" style="width: 80px; text-align: center;"> </div>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;"> <label for="block-cooldown-input" style="margin-bottom: 0;"data-lang-key="apiBlockCooldownLabel"> AI被拉黑后冷静期 (小时) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
              被拉黑超过这个时间后，AI才有几率重新申请好友。 </p> </label> <input type="number" id="block-cooldown-input" min="0.1" step="0.1" value="1" style="width: 80px; text-align: center;"> </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiTtsSettings">语音消息设置 (Minimax TTS)</h3>
        <p style="font-size: 14px; color: #666; background-color: #f0f0f0; padding: 10px; border-radius: 8px;"> 在 AI 回复的文字前加上 <code style="background-color: #e0e0e0; padding: 2px 4px; border-radius: 4px;">[V]</code> 前缀，即可让该条消息自动渲染为可播放的语音。</p>
        <div class="form-group"> <label for="minimax-group-id">Minimax Group ID</label> <input type="text" id="minimax-group-id" placeholder="在此输入你的 Group ID"></div>
        <div class="form-group"> <label for="minimax-api-key">Minimax API Key</label> <input type="password" id="minimax-api-key" placeholder="在此输入你的 API Key"></div>
        <div class="form-group"> <label for="minimax-model-select"data-lang-key="apiTtsModelLabel">语音模型 (Model)</label> <select id="minimax-model-select">
            <option value="speech-01">speech-01 (标准)</option>
            <option value="speech-02">speech-02 (高清)</option>
          </select></div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiPerformanceSettings"data-lang-key="apiPerformanceSettings">性能与显示设置</h3>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;"> <label for="chat-list-render-window-input" style="margin-bottom: 0;"data-lang-key="apiChatListRenderWindowLabel"> 聊天列表每次加载条数 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
              控制主页聊天列表下拉时每次加载会话的数量。默认30。 </p> </label> <input type="number" id="chat-list-render-window-input" min="10" value="30" style="width: 80px; text-align: center;"> </div>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;"> <label for="chat-render-window-input" style="margin-bottom: 0;"data-lang-key="apiChatRenderWindowLabel"> 聊天界面初始加载条数 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
              打开聊天时默认显示的最近消息数量。值越大，初次加载越慢。 </p> </label> <input type="number" id="chat-render-window-input" min="10" value="50" style="width: 80px; text-align: center;"> </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiImageGenSettings">生图功能设置</h3>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="enable-ai-drawing-switch" style="margin-bottom: 0;"data-lang-key="apiEnableImageGenLabel"> 启用AI生图功能 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
              关闭后，所有需要AI生成的图片（动态、头像等）都将显示为占位图，以节省流量和API费用。 </p> </label> <label class="toggle-switch"> <input type="checkbox" id="enable-ai-drawing-switch"> <span class="slider"></span> </label> </div>
<!-- ▼▼▼ NovelAI 图像生成系统配置 ▼▼▼ -->
<hr style="margin:20px 0; opacity:.3">
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
    <label for="novelai-switch" style="margin-bottom: 0;">
        启用 NovelAI 图像生成
        <p style="font-size: 12px; font-weight: normal; color: #666; margin-top: 5px;">
            开启后可使用NovelAI官方API生成高质量动漫风格图像（必开🔮）
        </p>
    </label>
    <label class="toggle-switch">
        <input type="checkbox" id="novelai-switch">
        <span class="slider"></span>
    </label>
</div>

<div id="novelai-details" style="display: none;">
    <div class="form-group">
        <label for="novelai-model" style="color: #333;"data-lang-key="apiNovelAIModelLabel">NovelAI 模型</label>
        <select id="novelai-model" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; border-radius: 4px;">
            <option value="nai-diffusion-4-curated-preview">NAI Diffusion V4.5 Curated (精选版无nsfw)</option>
            <option value="nai-diffusion-4-5-full">NAI Diffusion V4.5 Full（完整版含nsfw）</option>
            <option value="nai-diffusion-3">NAI Diffusion Anime V3（旧版）</option>
            <option value="nai-diffusion-furry-3">NAI Diffusion Furry V3（旧旧版）</option>
        </select>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            💡 必须有oplus订阅的apikey才可以使用！
        </p>
    </div>

    <div class="form-group">
        <label for="novelai-api-key" style="color: #333;"data-lang-key="apiNovelAIKeyLabel">NovelAI API Key</label>
        <div style="position: relative;">
            <input type="password" id="novelai-api-key" placeholder="pst-xxxxxxxxxxxxxxxx" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding-right: 40px;">
            <span id="novelai-key-toggle" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; user-select: none; font-size: 18px;">🧐</span>
        </div>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            💡 在 <a href="https://novelai.net" target="_blank" style="color: #007bff;">NovelAI官网</a> 获取API Key
        </p>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button type="button" id="novelai-settings-btn" style="flex: 1; background-color: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;"data-lang-key="apiNovelAIGenSettingsBtn">
            ⚙️ 生成设置
        </button>
        <button type="button" id="novelai-test-btn" style="flex: 1; background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;"data-lang-key="apiNovelAITestBtn">
            🧪 测试生成
        </button>
    </div>
</div>
<!-- ▲▲▲ NovelAI 图像生成系统配置结束 ▲▲▲ -->

<hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiStorageOptimization">存储空间优化</h3>

        <p id="total-image-size-display" style="font-size: 14px; color: var(--text-secondary); margin-bottom: 15px; text-align: center;">
            正在计算本地图片总大小...
        </p>
        <button class="form-button form-button-secondary" id="compress-images-btn" style="background-color: #e8f5e9; color: #2e7d32; border-color: #c8e6c9;"data-lang-key="apiCompressImagesBtn">
             一键压缩本地图片
        </button>
        <hr style="margin: 30px 0; opacity: 0.3;"> <button class="form-button" id="save-api-settings-btn" style="margin-top: 20px;"data-lang-key="apiSaveAllBtn">保存所有设置</button> <button class="form-button" id="export-data-btn"data-lang-key="apiExportDataBtn">导出数据</button> <button class="form-button" id="import-btn"data-lang-key="apiImportDataBtn">导入备份文件</button><button
          class="form-button form-button-secondary" id="cleanup-data-btn" style="background-color: #ffebee; color: #c62828; border-color: #ef9a9a; margin-top: 10px;"data-lang-key="apiCleanupDataBtn">清理冗余数据</button><button class="form-button form-button-secondary" id="delete-world-books-btn"
          style="background-color: #ffebee; color: #c62828; border-color: #ef9a9a; margin-top: 10px;"data-lang-key="apiDeleteWorldBooksBtn">删除世界书</button><button class="form-button form-button-secondary" id="clear-specific-data-btn"
          style="background-color: #ffcdd2; color: #b71c1c; border-color: #ef9a9a; margin-top: 10px;"data-lang-key="apiAdvancedCleanupBtn">高级数据清理</button><button class="form-button form-button-secondary" id="check-and-fix-data-btn"
          style="background-color: #e3f2fd; color: #0d47a1; border-color: #bbdefb; margin-top: 10px;"data-lang-key="apiCheckAndFixDataBtn">数据检查与修复</button> <input id="import-data-input" type="file" accept="application/json" hidden>

      </div>
    </div>

    <div id="chat-list-screen" class="screen">
      <div class="header" id="main-chat-list-header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span id="chat-list-title"data-lang-key="chatListTitle">消息</span>
        <div class="header-actions"> <span class="action-btn" id="add-group-chat-btn" title="创建群聊"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.5 17.5C19.1569 17.5 20.5 16.1569 20.5 14.5C20.5 12.8431 19.1569 11.5 17.5 11.5C15.8431 11.5 14.5 12.8431 14.5 14.5C14.5 16.1569 15.8431 17.5 17.5 17.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M21 21L19 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M8.5 11.5C10.1569 11.5 11.5 10.1569 11.5 8.5C11.5 6.84315 10.1569 5.5 8.5 5.5C6.84315 5.5 5.5 6.84315 5.5 8.5C5.5 10.1569 6.84315 11.5 8.5 11.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M12.5 14.5H4.5C3.39543 14.5 2.5 15.3954 2.5 16.5V18.5H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg></span> <span class="action-btn" id="add-chat-btn">+</span> </div>
      </div>
      <div id="messages-view" class="chat-list-view active">
        <div id="chat-list"> </div>
      </div>
      <div id="qzone-screen" class="chat-list-view">
        <div class="qzone-header"> <span class="back-btn" id="qzone-back-btn">‹</span> <span data-lang-key="qzoneTitle">好友动态</span>
          <div class="header-actions"> <span class="action-btn" id="qzone-more-actions-btn" title="更多操作">…</span> </div>
        </div>
        <div class="qzone-content">
          <div class="qzone-profile-header">
            <div id="qzone-banner-container" class="qzone-banner-container"> <img id="qzone-banner-img" src="https://files.catbox.moe/r5heyt.gif" alt="背景"> <input type="file" id="qzone-banner-input" accept="image/*" hidden> </div>
            <div class="qzone-user-info">
              <div id="qzone-avatar-container" class="qzone-avatar-container"> <img id="qzone-avatar-img" src="https://files.catbox.moe/q6z5fc.jpeg" alt="头像"> <input type="file" id="qzone-avatar-input" accept="image/*" hidden> </div> <span id="qzone-nickname">{{user}}</span>
            </div>
          </div>
          <div class="qzone-actions-bar">
            <div class="action-item" id="create-shuoshuo-btn"><span data-lang-key="qzoneActionShuoshuo">说说</span></div>
            <div class="action-item" id="create-post-btn"><span data-lang-key="qzoneActionPost">动态</span></div>
            <div class="action-item" id="open-album-btn"><span data-lang-key="qzoneActionAlbum">相册</span></div>
          </div>
          <div id="qzone-posts-list"></div>
        </div>
      </div>
      <div id="favorites-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="favorites-back-btn">‹</span> <span data-lang-key="navFavorites">我的收藏</span> <span class="action-btn" id="favorites-edit-btn"data-lang-key="edit">编辑</span> </div>
        <div class="search-bar-container"> <input type="search" id="favorites-search-input" placeholder="搜索收藏的标题、内容或作者..."> <button id="favorites-search-clear-btn" class="search-clear-btn" style="display: none;">×</button> </div>
        <div id="favorites-list" class="list-container"> </div>
        <div id="favorites-action-bar" style="display: none;"> <button id="favorites-delete-selected-btn" class="action-bar-btn">删除 (0)</button> </div>
      </div>
      <div id="memories-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="memories-back-btn">‹</span> <span>我们的回忆</span> <span class="action-btn" id="add-countdown-btn">+</span> </div>
        <div id="memories-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
      </div>
      <div id="npc-list-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="npc-list-back-btn">‹</span> <span>NPC 列表</span>
          <div class="header-actions"> <span class="action-btn" id="add-npc-btn">+</span> </div>
        </div>
        <div id="npc-list" class="list-container" style="padding: 0;"> </div>
      </div>
      <div id="chat-list-bottom-nav">
        <div class="nav-item active" data-view="messages-view"> <span data-lang-key="navMessages">消息</span> </div>
        <div class="nav-item" data-view="qzone-screen"> <span data-lang-key="navQzone">动态</span> </div>
        <div class="nav-item" data-view="memories-view"> <span data-lang-key="navMemories">回忆</span> </div>
        <div class="nav-item" data-view="favorites-view"> <span data-lang-key="navFavorites">收藏</span> </div>
        <div class="nav-item" data-view="npc-list-view"> <span data-lang-key="navNpcList">NPC</span> </div>
      </div>
    </div>
    <div id="album-screen" class="screen">
      <div class="header"> <span class="back-btn" id="album-back-btn">‹</span> <span>我的相册</span> <span class="action-btn" id="create-album-btn-page">+</span> </div>
      <div class="list-container">
        <div id="album-grid-page"> </div>
      </div>
    </div>
    <div id="album-photos-screen" class="screen">
      <div class="header"> <span class="back-btn" id="album-photos-back-btn">‹</span> <span id="album-photos-title">相册名称</span> <span class="action-btn" id="album-upload-photo-btn">上传</span> </div>
      <div class="list-container">
        <div id="photos-grid-page"> </div>
        <div id="photo-viewer-modal" class="modal"> <button id="photo-viewer-close-btn">×</button> <button id="photo-viewer-prev-btn" class="nav-arrow">‹</button>
          <div class="photo-viewer-content"> <img id="photo-viewer-image" src="" alt="全屏照片预览"> </div> <button id="photo-viewer-next-btn" class="nav-arrow">›</button>
        </div>
      </div>
    </div>
    <div id="npc-editor-modal" class="modal">
      <div class="modal-content" style="height: 80%;">
        <div class="modal-header"> <span id="npc-editor-title"data-lang-key="add">添加 NPC</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>NPC 头像</label>
            <div class="avatar-upload"> <img id="npc-avatar-preview" src="https://i.postimg.cc/VkQfgzGJ/1.jpg"> <button onclick="document.getElementById('npc-avatar-input').click()">上传头像</button> <input type="file" id="npc-avatar-input" accept="image/*" hidden> </div>
          </div>
          <div class="form-group"> <label for="npc-name-input">NPC 昵称</label> <input type="text" id="npc-name-input" placeholder="输入NPC的常用名"> </div>
          <div class="form-group"> <label for="npc-persona-input">NPC 人设</label> <textarea id="npc-persona-input" rows="4" placeholder="详细描述这个NPC的性格、背景、说话方式等..."></textarea> </div>
          <hr style="opacity: 0.2;">
          <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="npc-background-activity-switch" style="margin-bottom: 0;"> 启用独立后台活动 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
                允许该NPC在后台独立发表动态评论。需同时开启API设置中的总开关。 </p> </label> <label class="toggle-switch"> <input type="checkbox" id="npc-background-activity-switch"> <span class="slider"></span> </label> </div>
          <div class="form-group"> <label for="npc-action-cooldown-input"> 独立行动冷却 (分钟) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 该NPC在后台主动行动的最小间隔。 </p> </label> <input type="number" id="npc-action-cooldown-input" min="1" value="15"
              style="width: 80px; text-align: center;"> </div>
          <div class="form-group"> <label>关联的角色 (NPC会去评论这些角色的动态)</label>
            <div id="npc-association-list" style="max-height: 150px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;"> </div>
          </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-npc-editor-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-npc-btn">保存</button> </div>
      </div>
    </div>
    <div id="chat-interface-screen" class="screen">
      <div id="gomoku-overlay">
        <div id="gomoku-content-wrapper"> <canvas id="gomoku-board"></canvas>
          <div id="gomoku-controls"> <button id="close-gomoku-btn">收起棋盘</button> </div>
        </div>
      </div>
      <div id="reading-overlay">
        <div id="reading-restore-btn" style="display: none;">📖</div>
        <div id="reading-window">
          <div class="reading-header"> <span id="reading-title">未选择书籍</span>
            <div class="reading-controls"> <button id="minimize-reading-btn" title="最小化" style="font-size: 20px; line-height: 1;"> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg> </button> <button id="open-reading-library-btn" title="打开书库" style="font-size: 22px; line-height: 1;"> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="3" y1="12" x2="21" y2="12"></line>
                  <line x1="3" y1="6" x2="21" y2="6"></line>
                  <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg></button> <button id="close-reading-btn" title="关闭"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg> </button></div>
          </div>
          <div id="reading-content">
            <p>点击“导入”按钮，<br>从本地.txt文件或网络URL加载书籍内容。</p>
          </div>
          <div class="reading-footer"> <button id="prev-page-btn">上一页</button> <span id="page-indicator">0 / 0</span> <button id="next-page-btn">下一页</button> </div>
        </div>
      </div><input type="file" id="book-upload-input" accept=".txt, text/plain" hidden>
      <div class="header">
        <div class="default-controls"> <span class="back-btn" id="back-to-list-btn">‹</span>
          <div id="global-lyrics-bar"></div>
          <div id="chat-header-title-wrapper"> <span id="chat-header-title">聊天对象</span>
            <div id="chat-header-status"> <span class="status-dot"></span> <span class="status-text">在线</span> </div>
          </div>
          <div class="header-actions"> <span class="action-btn" id="open-memory-screen-btn" title="长期记忆"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M12 6L9 9L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M21 5V19C21 20.1046 20.1046 21 19 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg> </span> <span class="action-btn" id="listen-together-btn" title="一起听"><img src="https://i.postimg.cc/dV8sdNcx/210-20250618115221.png" alt="一起听"></span> <span class="action-btn" id="chat-settings-btn" title="聊天设置"><img
                src="https://i.postimg.cc/bvPq64cv/CCA834-BA-5-A90-408-D-94-FA-7-EE156-B6-A765.png" alt="设置"></span> </div>
        </div>
        <div class="selection-controls"> <span id="selection-cancel-btn"data-lang-key="chatSelectionCancel">取消</span> <span id="selection-count"></span>
          <div class="header-actions"> <span id="selection-screenshot-btn" class="action-btn"data-lang-key="chatSelectionScreenshot">长截图</span> <span id="selection-favorite-btn" class="action-btn"data-lang-key="chatSelectionFavorite">收藏</span> <span id="selection-share-btn" class="action-btn"data-lang-key="chatSelectionShare">分享</span> <span id="selection-soft-delete-btn" class="action-btn"data-lang-key="chatSelectionSoftDelete">删除(通知AI)</span>
            <span id="selection-erase-btn" class="action-btn" style="color: #ff3b30;"data-lang-key="chatSelectionHardDelete">彻底删除</span> </div>
        </div>
      </div>
      <div id="chat-messages">
        <div id="typing-indicator">对方正在输入...</div>
      </div>
      <div id="chat-input-area">
        <div id="chat-at-mention-popup" class="at-mention-popup"></div>
        <div id="reply-preview-bar">
          <div class="reply-preview-content">
            <div class="sender">回复 xxx:</div>
            <div class="text">被引用的消息内容...</div>
          </div> <span id="cancel-reply-btn">×</span>
        </div>
        <div id="chat-input-actions-top"> <button id="open-sticker-panel-btn" class="chat-action-icon-btn action-button" title="表情面板">+</button> <button id="send-photo-btn" class="chat-action-icon-btn action-button" title="发送照片"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
              <circle cx="12" cy="13" r="4"></circle>
            </svg></button> <button id="upload-image-btn" class="chat-action-icon-btn action-button" title="上传图片"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 3.5H3C2.44772 3.5 2 3.94772 2 4.5V19.5C2 20.0523 2.44772 20.5 3 20.5H21C21.5523 20.5 22 20.0523 22 19.5V4.5C22 3.94772 21.5523 3.5 21 3.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M16.5 13.5C17.6046 13.5 18.5 12.6046 18.5 11.5C18.5 10.3954 17.6046 9.5 16.5 9.5C15.3954 9.5 14.5 10.3954 14.5 11.5C14.5 12.6046 15.3954 13.5 16.5 13.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M22 14.5L18 10.5L10.3333 18.5M12.5 16L9 12.5L2 19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg> </button> <button id="transfer-btn" class="chat-action-icon-btn action-button" title="转账">￥</button> <button id="voice-message-btn" class="chat-action-icon-btn action-button" title="发送语音"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <path d="M12 19v4"></path>
              <path d="M8 23h8"></path>
            </svg></button> <button id="send-waimai-request-btn" class="chat-action-icon-btn action-button" title="发起外卖请求"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg></button> <button id="video-call-btn" class="chat-action-icon-btn action-button" title="视频通话"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="23 7 16 12 23 17 23 7"></polygon>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg></button> <button id="group-video-call-btn" class="chat-action-icon-btn action-button" title="群视频通话"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg></button> <button id="send-poll-btn" class="chat-action-icon-btn action-button" title="发起投票"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 6h10"></path>
              <path d="M6 6h.01"></path>
              <path d="M8 12h10"></path>
              <path d="M6 12h.01"></path>
              <path d="M8 18h10"></path>
              <path d="M6 18h.01"></path>
            </svg></button> <button id="share-link-btn" class="chat-action-icon-btn action-button" title="分享链接"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path>
            </svg></button> <button id="share-location-btn" class="chat-action-icon-btn action-button" title="共享位置"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg></button> <button id="gomoku-btn" class="chat-action-icon-btn action-button" title="五子棋"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="4"></circle>
              <circle cx="12" cy="12" r="7"></circle>
            </svg> </button> <button id="open-shopping-btn" class="chat-action-icon-btn action-button" title="购物"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> </button> <button id="edit-last-response-btn" class="chat-action-icon-btn action-button" title="导演模式：编辑AI上一轮的完整响应"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg> </button> <button id="regenerate-btn" class="chat-action-icon-btn action-button" title="重新生成回复" style="display: flex;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </button> <button id="propel-btn" class="chat-action-icon-btn action-button" title="推进剧情" style="display: flex;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <polygon points="13 19 22 12 13 5 13 19"></polygon>
              <polygon points="2 19 11 12 2 5 2 19"></polygon>
            </svg> </button> <button id="werewolf-game-btn" class="chat-action-icon-btn action-button" title="狼人杀" style="display: none;"> <svg width="24" height="24" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M332.6 128.5c-61.1 0-110.5 49.4-110.5 110.5 0 23.4 7.3 45.1 19.9 63.3-19.3 6.3-40.1 9.7-61.9 9.7-88.2 0-160-71.8-160-160s71.8-160 160-160c5.3 0 10.5.3 15.6.8C202.9 44.1 160 0 160 0s-53.3 44.1-45.9 92.5c-48.4 24.3-82.1 73.4-82.1 129.6 0 80.9 65.5 146.4 146.4 146.4 20.2 0 39.4-4.1 56.8-11.5 24.1 33.6 63.3 56.8 107.4 56.8 7.2 0 14.2-0.6 21-1.7 15.2 24.2 41.2 41.1 71.6 41.1 44.7 0 80.9-36.2 80.9-80.9 0-25.2-11.5-47.7-29.6-62.6 11.6-16.1 18.4-35.6 18.4-56.5C443.1 177.9 393.7 128.5 332.6 128.5zM180.1 85.8c-52.1 0-94.4 42.3-94.4 94.4s42.3 94.4 94.4 94.4 94.4-42.3 94.4-94.4S232.2 85.8 180.1 85.8zM332.6 170.9c-37.8 0-68.4 30.6-68.4 68.4s30.6 68.4 68.4 68.4 68.4-30.6 68.4-68.4S370.4 170.9 332.6 170.9z">
              </path>
            </svg></button><button id="read-together-btn" class="chat-action-icon-btn action-button" title="一起读书"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg></button> <button id="open-nai-gallery-btn" class="chat-action-icon-btn action-button" title="NAI画廊">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 3l1.91 5.86L20 10.9l-5.86 1.91L12 18.6l-1.91-5.86L4 10.9l5.86-1.91L12 3z"/>
        <path d="M5 3l1.5 4.5L11 9l-4.5 1.5L5 12l-1.5-4.5L-1 6l4.5-1.5L5 3z"/>
        <path d="M19 15l-1.5 4.5L13 21l4.5-1.5L19 18l1.5 4.5L25 21l-4.5-1.5L19 15z"/>
    </svg>
</button></div>
        <div id="chat-input-main-row"> <textarea id="chat-input" rows="1" placeholder="输入消息..."></textarea>
          <div id="input-actions-wrapper"> <button id="wait-reply-btn" title="等待回复"><img src="https://i.postimg.cc/q72zq80N/ECE92-BBC-BE57-48-E9-BB2-C-345-B6019-C4-B2.png" alt="等待回复"></button> <button id="send-btn" class="action-button">发送</button> </div>
        </div>
      </div>
      <div id="chat-lock-overlay">
        <div id="chat-lock-content"></div>
      </div>
    </div>
    <div id="wallpaper-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="appearanceTitle">外观设置</span> <span style="width: 30px;"></span> </div>
      <div class="form-container"> <label style="font-weight: 500; color: var(--text-secondary);">EPhone 主屏幕壁纸 (Screen Wallpaper)</label>
        <div id="wallpaper-preview">点击下方上传</div>
        <div class="bg-upload-container"> <button class="form-button-secondary" onclick="document.getElementById('wallpaper-upload-input').click();">本地上传</button> <button id="upload-ephone-bg-url-btn" class="form-button-secondary">网络URL</button> <button id="remove-ephone-bg-btn"
            class="form-button-secondary">移除壁纸</button> </div> <input type="file" id="wallpaper-upload-input" accept="image/*" hidden>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;"> <label style="font-weight: 500; color: var(--text-secondary);">CPhone 手机壁纸 (Screen Wallpaper)</label>
        <div id="cphone-wallpaper-preview">点击下方上传</div>
        <div class="bg-upload-container"> <button class="form-button-secondary" onclick="document.getElementById('cphone-wallpaper-upload-input').click();">本地上传</button> <button id="upload-cphone-bg-url-btn" class="form-button-secondary">网络URL</button> <button id="remove-cphone-bg-btn"
            class="form-button-secondary">移除壁纸</button> </div> <input type="file" id="cphone-wallpaper-upload-input" accept="image/*" hidden>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;"> <label style="font-weight: 500; color: var(--text-secondary);">全局聊天背景 (Global chat background)</label>
        <div id="global-bg-preview" class="wallpaper-preview" style="height: 160px; width: 90px;">点击下方上传</div>
        <div class="bg-upload-container"> <button class="form-button-secondary" onclick="document.getElementById('global-bg-input').click()">本地上传</button> <button id="upload-global-bg-url-btn" class="form-button-secondary">网络URL</button> <button id="remove-global-bg-btn"
            class="form-button-secondary">移除全局背景</button> </div> <input type="file" id="global-bg-input" accept="image/*" style="display: none;">
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="theme-toggle-switch" style="margin-bottom: 0;">夜间模式 (Night Mode)</label> <label class="toggle-switch"> <input type="checkbox" id="theme-toggle-switch"> <span class="slider"></span>
          </label> </div>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="status-bar-toggle-switch" style="margin-bottom: 0;">顶部状态栏 (top status bar)</label> <label class="toggle-switch"> <input type="checkbox" id="status-bar-toggle-switch"> <span
              class="slider"></span> </label> </div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div style="width:100%; text-align: left; margin-bottom: 15px;"> <label style="font-weight: 500; color: var(--text-secondary);">消息提示音(Notification sound)</label> </div>
        <div class="form-group" style="width:100%;"> <label for="notification-sound-url-input">提示音文件 URL (.mp3, .wav, .ogg)</label>
          <div style="display: flex; gap: 10px; align-items: center; margin-top: 8px;"> <input type="text" id="notification-sound-url-input" placeholder="留空则使用默认提示音" style="flex-grow: 1;"> <button id="test-sound-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">▶</button>
            <button id="reset-sound-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">重置</button> </div>
        </div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div style="width:100%; text-align: left; margin-bottom: 15px;"> <label style="font-weight: 500; color: var(--text-secondary);">EPhone App 图标设置(Icon Settings)</label> </div>
        <div id="icon-settings-grid"></div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div class="form-group" style="width:100%;">
          <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;"> <label>聊天工具栏按钮排序(Chat toolbar button sorting)</label> <button id="reset-button-order-btn" title="恢复默认顺序" class="form-button-secondary" style="margin: 0; padding: 4px 12px; font-size: 13px;">重置顺序</button> </div>
          <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 按住下方的按钮并拖动即可排序，设置会自动保存。 </p>
          <div id="button-order-editor" style="display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; background-color: #f0f2f5; border-radius: 8px; border: 1px solid var(--border-color);"> </div>
        </div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div style="width:100%; text-align: left; margin-bottom: 15px;"> <label style="font-weight: 500; color: var(--text-secondary);">CPhone App 图标设置(Icon Settings)</label> </div>
        <div id="cphone-icon-settings-grid"></div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <h3 style="margin-top:0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; width:100%; text-align: left;">外观预设管理(Appearance Preset)</h3>
        <p style="font-size: 12px; color: #8a8a8a; margin-top: -5px; line-height: 1.5; width:100%; text-align: left;"> 一键保存或加载壁纸、图标、按钮排序、主题等所有非CSS的视觉风格。</p>
        <div class="form-group" style="width:100%;"> <label for="appearance-preset-select"data-lang-key="apiPresetSelectLabel">选择或切换预设</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="appearance-preset-select" style="flex-grow: 1;"></select> <button id="save-appearance-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button
              id="delete-appearance-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <h3 style="margin-top:0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; width:100%; text-align: left;">CSS 预设管理(CSS Preset)</h3>
        <div class="form-group" style="width:100%;"> <label for="css-preset-select"data-lang-key="apiPresetSelectLabel">选择或切换预设</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="css-preset-select" style="flex-grow: 1;"></select> <button id="save-css-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button id="delete-css-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <div class="form-group" style="width:100%;"> <label for="global-css-input"> 全局美化样式 (CSS) <button id="reset-global-css-btn" type="button"
              style="background: none; border: 1px solid #ccc; color: #555; font-size: 12px; padding: 2px 8px; border-radius: 5px; cursor: pointer; margin-left: 10px;">重置</button> </label> <textarea id="global-css-input" rows="6"
            style="width: 100%; margin-top: 8px; font-family: monospace; font-size: 16px; resize: vertical;" placeholder="/* 在此输入自定义CSS */"></textarea> </div> <button class="form-button form-button-secondary" id="import-appearance-btn" style="margin-top: 10px;">导入外观 (JSON)</button>
        <input type="file" id="import-appearance-input" accept="application/json" hidden> <button class="form-button" id="save-wallpaper-btn" style="margin-top: 30px;"data-lang-key="appearanceSaveAll">保存所有外观设置</button>
      </div>
    </div>
    <div id="browser-screen" class="screen">
      <div class="header"> <span class="back-btn" id="browser-back-btn">‹</span> <span id="browser-title"></span> <span style="width: 30px;"></span> </div>
      <div id="browser-content" class="list-container"> </div>
    </div>
    <div id="font-settings-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="fontSettingsTitle">字体设置</span> <span style="width: 30px;"></span> </div>
      <div class="form-container">
        <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="fontPresetManagement">字体预设管理</h3>
        <div class="form-group"> <label for="font-preset-select"data-lang-key="apiPresetSelectLabel">选择或切换预设</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="font-preset-select" style="flex-grow: 1;"></select> <button id="save-font-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button id="delete-font-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <div class="form-group"> <label for="font-url-input"data-lang-key="fontFileUrlLabel">字体文件URL (.ttf, .otf, .woff等)</label> <input type="text" id="font-url-input" placeholder="https://..../font.ttf"> </div>
        <div class="form-group"> <label data-lang-key="fontPreviewLabel">实时预览</label>
          <div id="font-preview">
            <p style="font-size: 20px; margin: 0 0 10px 0;">你好世界 Hello World</p>
            <p style="margin: 0;">这是字体预览效果，12345。</p>
          </div>
        </div> <button class="form-button" id="save-font-btn"data-lang-key="fontSaveAndApply">保存并应用</button> <button class="form-button form-button-secondary" id="reset-font-btn"data-lang-key="fontResetDefault">恢复默认字体</button>
      </div>
    </div>
    <div id="werewolf-game-screen" class="screen">
      <div class="header"> <span id="werewolf-game-title">狼人杀</span>
        <div class="header-actions"><span class="action-btn" id="werewolf-retry-btn" title="重试上一步AI操作" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg></span> <span class="action-btn" id="exit-werewolf-game-btn">退出</span> </div>
      </div>
      <div id="werewolf-player-grid"></div>
      <div id="werewolf-log" class="list-container"></div>
      <div id="werewolf-action-bar">
        <div id="chat-input-main-row" style="width: 100%;"> <textarea id="werewolf-user-input" rows="1" placeholder="轮到你发言了..."></textarea>
          <div id="input-actions-wrapper" style="gap: 5px;"> <button id="werewolf-wait-reply-btn" class="action-button" style="display: none; background-color: #007bff; height: 40px; padding: 0 10px; font-size: 13px;">等待回应</button> <button id="werewolf-finish-speech-btn" class="action-button"
              style="display: none; background-color: var(--accent-color); height: 40px; padding: 0 10px; font-size: 13px;">结束发言</button> <button id="werewolf-next-step-btn" class="form-button" style="margin-top:0; display: none;">下一步</button> </div>
        </div>
      </div>
    </div>
    <div id="long-term-memory-screen" class="screen">
      <div class="header"> <span class="back-btn" id="memory-screen-back-btn">‹</span> <span data-lang-key="chatHeaderLongTermMemory">长期记忆</span>
        <div class="header-actions"> <span class="action-btn" id="refine-memory-btn-header">精炼</span> <span class="action-btn" id="summarize-recent-btn-header">总结</span> <span class="action-btn" id="add-manual-memory-btn-header">+</span> </div>
      </div>
      <div class="list-container" id="memory-list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px; background-color: #f0f2f5;"> </div>
    </div>
    <div id="chat-settings-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('chat-interface-screen')">‹</span> <span data-lang-key="chatHeaderChatSettings">聊天设置</span> <span class="save-btn" id="save-chat-settings-btn"data-lang-key="save">保存</span> </div>
      <div class="form-container">
        <div class="form-group" id="chat-name-group"><label for="chat-name-input">备注名 / 群名(Remark Name / Group Name)</label><input type="text" id="chat-name-input"></div>
        <div class="form-group" id="my-nickname-group"> <label for="my-nickname-input">我的昵称(My nickname)</label> <input type="text" id="my-nickname-input"> </div>
        <div class="form-group" id="assign-group-section" style="display: none;"> <label for="assign-group-select">好友分组(Friend Group)</label>
          <div style="display: flex; align-items: center; gap: 10px;"> <select id="assign-group-select" style="flex-grow: 1;"></select> <button id="manage-groups-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">管理分组</button> </div>
        </div>
        <div class="form-group" id="my-group-nickname-group"><label for="my-group-nickname-input">我的群昵称(My group nickname)</label><input type="text" id="my-group-nickname-input"></div> <button class="form-button form-button-secondary" id="search-history-btn" style="margin-top: 10px;">搜索聊天记录</button>
        <div class="form-group" id="single-char-background-activity-group">
          <div style="display: flex; justify-content: space-between; align-items: center;"> <label for="char-background-activity-switch" style="margin-bottom: 0;"> 启用独立后台活动 (Enable standalone background activity)<p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 允许该角色在后台独立发消息或动态。需同时开启API设置中的总开关。 </p> </label>
            <label class="toggle-switch"> <input type="checkbox" id="char-background-activity-switch"> <span class="slider"></span> </label> </div>
        </div>
        <div class="form-group" id="ai-cooldown-group"> <label for="ai-action-cooldown-input"> 独立行动冷却 (分钟)(Independent Action Cooldown (minutes)) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> AI在后台主动发消息或动态的最小间隔。 </p> </label> <input type="number" id="ai-action-cooldown-input" min="1" value="10"
            style="width: 80px; text-align: center;"> </div>
        <div class="form-group" id="ai-original-name-group"> <label for="ai-original-name-input">对方本名 (The other party's real name)</label> <input type="text" id="ai-original-name-input"> </div>
        <div class="form-group" id="ai-persona-group"><label for="ai-persona">对方人设 (AI Persona)</label><textarea id="ai-persona" rows="3"></textarea></div>
        <div class="form-group" id="ai-avatar-group"><label>对方头像(Opponent's avatar)</label>
          <div class="avatar-upload"><img id="ai-avatar-preview"><button onclick="document.getElementById('ai-avatar-input').click()">上传对方头像</button><button id="manage-ai-avatar-library-btn">管理头像库</button><button class="change-frame-btn" data-type="ai">更换头像框</button> <input type="file"
              id="ai-avatar-input" accept="image/*"> </div>
        </div>
        <div class="form-group" id="my-persona-group"><label for="my-persona">我的人设 (My Persona)</label><textarea id="my-persona" rows="3"></textarea></div>
        <div class="form-group" id="my-avatar-group"> <label>我的头像(My profile picture)</label>
          <div class="avatar-upload"> <img id="my-avatar-preview"> <button onclick="document.getElementById('my-avatar-input').click()">上传我的头像</button> <button id="manage-my-avatar-library-btn">管理头像库</button> <button class="change-frame-btn" data-type="my">更换头像框</button> <button
              id="open-persona-library-btn">预设</button> <input type="file" id="my-avatar-input" accept="image/*"> </div>
        </div>
        <div class="form-group" id="group-members-group"><label>群成员人设(Character setting of group members)</label>
          <div id="group-members-settings"></div> <button id="manage-members-btn" class="form-button form-button-secondary" style="margin-top: 15px;">管理群成员</button>
        </div>
        <div class="form-group"> <label for="max-memory">短期记忆（上下文）条数</label> <input type="number" id="max-memory" value="10"> </div>
        <hr style="opacity: 0.3; margin: 20px 0;">
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="auto-memory-toggle" style="margin-bottom: 0;"> 启用自动总结长期记忆(Enable automatic long-term memory summarization) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 开启后，AI会在对话达到一定长度时，自动将内容提炼为长期记忆。 </p>
          </label> <label class="toggle-switch"> <input type="checkbox" id="auto-memory-toggle"> <span class="slider"></span> </label> </div>
        <div class="form-group"> <label for="auto-memory-interval">自动总结间隔（消息条数）(Automatic summary interval (number of messages))</label> <input type="number" id="auto-memory-interval" min="10" value="20" style="width: 80px; text-align: center;">
          <p style="font-size: 12px; color: #8a8a8a; margin-top: 8px;"> 建议值 60-150。值越小，总结越频繁，但API费用也越高。 </p>
        </div>
        <hr style="opacity: 0.3; margin: 20px 0;">
        <div class="form-group"> <label>聊天气泡主题(Chat bubble theme) <button id="reset-theme-btn" type="button">重置</button></label>
          <div class="theme-selector"> <label><input type="radio" name="theme-select" value="default" id="theme-default"> 默认</label> <label><input type="radio" name="theme-select" value="pink_blue"> 粉蓝</label> <label><input type="radio" name="theme-select" value="blue_white"> 蓝白</label>
            <label><input type="radio" name="theme-select" value="purple_yellow"> 紫黄</label> <label><input type="radio" name="theme-select" value="black_white"> 黑白</label> <label><input type="radio" name="theme-select" value="yellow_white"> 黄白</label> <label><input type="radio" name="theme-select"
                value="red_black"> 红黑</label> <label><input type="radio" name="theme-select" value="blue_yellow"> 蓝黄</label> <label><input type="radio" name="theme-select" value="pink_yellow"> 粉黄</label> <label><input type="radio" name="theme-select" value="pink_purple"> 粉紫</label> <label><input
                type="radio" name="theme-select" value="gray_white"> 灰白</label> <label><input type="radio" name="theme-select" value="blue_green"> 蓝绿</label> <label><input type="radio" name="theme-select" value="pink_white"> 粉白</label>
            <label><input type="radio" name="theme-select" value="pink_black"> 粉黑</label> <label><input type="radio" name="theme-select" value="pink_green"> 粉绿</label> <label><input type="radio" name="theme-select" value="green_black"> 绿黑</label>
          </div>
        </div>
        <div class="form-group"> <label for="font-size-slider">聊天字体大小 (Chat font size)<span id="font-size-value">13px</span></label> <input type="range" id="font-size-slider" min="12" max="20" step="1" value="13" style="width: 100%; margin-top: 8px;"> </div>
        <div class="form-group"> <label for="custom-css-input"> 自定义气泡样式 (CSS) <button id="reset-custom-css-btn" type="button" style="background: none; border: 1px solid #ccc; color: #555; font-size: 12px; padding: 2px 8px; border-radius: 5px; cursor: pointer; margin-left: 10px;">重置</button>
          </label> <textarea id="custom-css-input" rows="5" style="width: 100%; margin-top: 8px; font-family: monospace; font-size: 16px; resize: vertical;"
            placeholder="/* 示例：为“我”的气泡添加渐变背景和阴影 */ .message-bubble.user .content { background: linear-gradient(135deg, #a1c4fd, #c2e9fb); box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 15px 4px 15px 15px; }"></textarea> </div>
        <div class="form-group"> <label>实时预览</label>
          <div id="settings-preview-area"></div>
        </div>
        <div class="form-group"> <label>聊天背景(Chat background)</label>
          <div class="bg-upload-container"> <button type="button" class="form-button-secondary" style="width: auto; padding: 8px 12px; margin-top: 0;" onclick="document.getElementById('bg-input').click()">上传背景图</button> <button type="button" id="remove-bg-btn">移除背景</button> </div> <img
            id="bg-preview" class="bg-preview-img"> <input type="file" id="bg-input" accept="image/*" style="display: none;">
        </div>
        <hr style="margin: 25px 0; border: none; border-top: 1px solid #eee;"> <button class="form-button form-button-secondary" id="block-chat-btn" style="background-color: #ff3b30; color: white; border-color: #ff3b30;">拉黑对方</button>
        <hr style="margin: 25px 0; border: none; border-top: 1px solid #eee;"><button class="form-button form-button-secondary" id="export-single-chat-btn" style="background-color: #e8f5e9; color: #2e7d32; border-color: #c8e6c9;">导出该聊天</button><button class="form-button form-button-secondary"
          id="import-single-chat-btn" style="background-color: #fff3e0; color: #ef6c00; border-color: #ffe0b2;">导入该聊天</button><input type="file" id="import-single-chat-input" accept="application/json" hidden> <button class="form-button form-button-secondary" id="clear-chat-btn">清空聊天记录</button>
      </div>
    </div>
    <div id="rendering-rules-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="homeAppRenderer">渲染规则</span> <span class="action-btn" id="add-new-rule-btn">+</span> </div>
      <div id="rules-tabs"> </div>
      <div id="rules-content-container"> </div>
    </div>
    <div id="rule-editor-modal" class="modal">
      <div class="modal-content" style="height: 85%;">
        <div class="modal-header"> <span id="rule-editor-title">创建新规则</span> </div>
        <div class="modal-body" style="display: flex; flex-direction: column; gap: 15px;">
          <div class="form-group" style="flex-shrink: 0;"> <label for="rule-name-input">规则名称</label> <input type="text" id="rule-name-input" placeholder="例如：美团外卖卡片"> </div>
          <div class="form-group" style="flex-shrink: 0;"> <label for="rule-chat-id-select">绑定范围</label> <select id="rule-chat-id-select">
              <option value="global">公用 (所有角色)</option>
            </select> </div>
          <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label for="rule-regex-input">正则表达式 (使用g作为标志)</label> <textarea id="rule-regex-input" rows="3" style="font-family: monospace; resize: vertical;" placeholder="例如：MTR\[(.*?)\]\[(.*?)\|(.*?)\]"></textarea>
          </div>
          <div class="form-group" style="flex-grow: 2; display: flex; flex-direction: column;"> <label for="rule-template-input">HTML 模板 (用 $1, $2 引用)</label> <textarea id="rule-template-input" rows="6" style="font-family: monospace; resize: vertical;"
              placeholder="例如：<div class=`waimai-card`>...<span>$2</span>...</div>"></textarea> </div>
          <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;"> <label for="rule-enabled-switch" style="margin-bottom: 0;">启用规则</label> <label class="toggle-switch"> <input type="checkbox" id="rule-enabled-switch" checked>
              <span class="slider"></span> </label> </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-rule-editor-btn" data-lang-key="cancel">取消</button> <button class="save" id="save-rule-btn"data-lang-key="save">保存规则</button> </div>
      </div>
    </div>
    <div id="search-history-screen" class="screen">
      <div class="header"> <span class="back-btn" id="search-history-back-btn">‹</span> <span>搜索聊天记录</span> <span style="width: 30px;"></span> </div>
      <div id="search-bar" style="padding: 10px 15px; border-bottom: 1px solid var(--border-color); background-color: var(--secondary-bg); flex-shrink: 0;">
        <div style="display: flex; gap: 10px; margin-bottom: 10px;"> <input type="search" id="keyword-search-input" placeholder="输入关键词..." style="flex-grow: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px;"> <input type="date" id="date-search-input"
            style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px;"> </div>
        <div style="display: flex; gap: 10px;"> <button id="execute-search-btn" class="form-button" style="margin-top: 0; flex-grow: 1;">搜索</button> <button id="clear-search-btn" class="form-button form-button-secondary" style="margin-top: 0; flex-grow: 1;">重置</button> </div>
      </div>
      <div id="chat-search-results-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
    </div>
    <div id="shopping-screen" class="screen">
      <div class="header">
        <div class="header-left-actions"> <span class="back-btn" id="shopping-back-btn">‹</span> <span class="action-btn" id="generate-shopping-items-btn" title="AI生成商品"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </span> </div> <span>购物中心</span>
        <div class="header-actions"> <span class="action-btn" id="go-to-cart-btn" title="查看购物车"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> <span id="cart-count">0</span> </span> </div>
      </div>
      <div id="product-category-tabs"></div>
      <div id="product-grid" class="list-container"> </div>
    </div>
  </div>
</body>
</html>