<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>星月小手机 ✨</title>
<style>
  :root{
    /* 星月主题（蓝紫） */
    --bg:#0f1120;
    --card:#151833;
    --soft:#1d2247;
    --text:#eef1ff;
    --muted:#9aa3c7;
    --accent: #7aa2ff;
    --accent-2:#b48aff;
    --edge: rgba(255,255,255,.08);
    --blur: blur(6px);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: "SF Pro Display","PingFang SC","Segoe UI",Roboto,Helvetica,Arial;
    color:var(--text); background: var(--bg);
    display:flex; align-items:center; justify-content:center; overflow:hidden;
  }
  /* 背景合影 */
  .bg{
    position:fixed; inset:0;
    background:url('./bg.jpg') center/cover no-repeat fixed;
    filter: brightness(.9);
  }
  .overlay{ position:fixed; inset:0; background:linear-gradient(180deg, rgba(10,12,26,.35), rgba(10,12,26,.75)); }

  /* 手机外框 */
  .phone{
    width:min(92vw,420px); height:min(92vh,820px);
    border-radius:28px; overflow:hidden; position:relative;
    box-shadow: 0 20px 80px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.06);
    backdrop-filter: var(--blur);
  }
  .glass{
    position:absolute; inset:0; background: rgba(18,22,42,.55); backdrop-filter: var(--blur);
  }
  /* 顶部状态栏 */
  .status{
    position:absolute; top:10px; left:0; right:0; display:flex; justify-content:center; pointer-events:none;
  }
  .clock{ font-weight:700; letter-spacing:.5px; text-shadow:0 0 12px rgba(0,0,0,.35);}
  /* 屏幕容器 */
  .screen{ position:absolute; inset:48px 0 78px; padding:16px; overflow:auto; }
  .title{font-size:18px; opacity:.85; margin:12px 0 8px}
  .muted{color:var(--muted); font-size:13px}
  .card{
    background:rgba(28,32,62,.55); border:1px solid var(--edge); border-radius:16px; padding:14px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }

  /* 主屏图标网格 */
  .grid{ display:grid; grid-template-columns:repeat(4,1fr); gap:14px; margin-top:26px;}
  .app{
    height:64px; border-radius:18px; display:flex; align-items:center; justify-content:center; flex-direction:column;
    background: linear-gradient(145deg, rgba(122,162,255,.18), rgba(180,138,255,.18));
    border:1px solid var(--edge); cursor:pointer; transition:.15s transform;
    user-select:none;
  }
  .app:active{ transform:scale(.96); }
  .app span{ font-size:12px; margin-top:6px }
  .emoji{ font-size:22px }

  /* 底栏 */
  .dock{
    position:absolute; left:0; right:0; bottom:10px; display:flex; gap:10px; justify-content:center;
    padding:8px 14px;
  }
  .dock .pill{
    flex:1; max-width:95%; height:56px; border-radius:18px; display:flex; align-items:center; justify-content:space-around;
    background:rgba(21,24,51,.65); border:1px solid var(--edge); backdrop-filter: var(--blur);
  }
  .dock .pill button{
    appearance:none; border:none; background:transparent; color:var(--text); font-size:15px; padding:8px 10px; border-radius:12px; cursor:pointer;
  }
  .dock .pill button.active{ background:rgba(122,162,255,.2); }

  /* 各屏样式 */
  .row{display:flex; gap:10px; align-items:center}
  .avatar{ width:36px; height:36px; border-radius:50%; background:#fff1; display:inline-flex; align-items:center; justify-content:center; font-size:18px }
  .bubble{ padding:10px 12px; border-radius:14px; background:#ffffff12; border:1px solid var(--edge); }
  .msg{ display:flex; gap:8px; margin:10px 0; }
  .msg.me{ flex-direction: row-reverse; }
  .msg.me .bubble{ background:#7aa2ff22; }

  input, textarea, select{
    width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--edge); background:#0e1130cc; color:var(--text);
    outline:none;
  }
  .row > button, .btn{
    appearance:none; border:none; background:linear-gradient(145deg, #7aa2ff, #b48aff);
    color:#fff; border-radius:12px; padding:10px 14px; cursor:pointer;
  }
  .gap{ height:12px; }

  /* 隐藏切换 */
  .hidden{ display:none; }
</style>
</head>
<body>
  <div class="bg"></div><div class="overlay"></div>

  <div class="phone">
    <div class="glass"></div>

    <!-- 顶部时间 -->
    <div class="status"><div class="clock" id="clock">--:--</div></div>

    <!-- 屏：主页 -->
    <div class="screen" id="home">
      <div class="card">
        <div class="title">欢迎回来，柒柒</div>
        <div class="muted">星月交辉 · Ethan × 柒柒</div>
      </div>

      <div class="grid">
        <div class="app" onclick="go('chat')"><div class="emoji">💬</div><span>聊天</span></div>
        <div class="app" onclick="go('moments')"><div class="emoji">📸</div><span>朋友圈</span></div>
        <div class="app" onclick="go('roles')"><div class="emoji">🎭</div><span>逸辰们</span></div>
        <div class="app" onclick="go('settings')"><div class="emoji">⚙️</div><span>设置</span></div>
      </div>

      <div class="gap"></div>
      <div class="card">
        <div class="title">今日情话 ✨</div>
        <div id="daily">把月亮借我一晚好不好，我要在你睫毛上挂一串星。</div>
      </div>
    </div>

    <!-- 屏：聊天 -->
    <div class="screen hidden" id="chat">
      <div class="title">与 <span id="roleNameTitle">逸辰</span> 的对话</div>
      <div id="chatList"></div>
      <div class="gap"></div>
      <div class="row">
        <input id="chatInput" placeholder="对我说点什么…" onkeydown="if(event.key==='Enter')send()"/>
        <button class="btn" onclick="send()">发送</button>
      </div>
    </div>

    <!-- 屏：朋友圈 -->
    <div class="screen hidden" id="moments">
      <div class="title">星月朋友圈</div>
      <div class="card" style="margin-bottom:10px">
        <textarea id="momentText" rows="3" placeholder="写点甜蜜的事…"></textarea>
        <div class="gap"></div>
        <button class="btn" onclick="postMoment()">发布</button>
      </div>
      <div id="momentList"></div>
    </div>

    <!-- 屏：分身 -->
    <div class="screen hidden" id="roles">
      <div class="title">选择一个分身</div>
      <div id="roleList"></div>
      <div class="gap"></div>
      <div class="card">
        <div class="title">新增分身</div>
        <div class="gap"></div>
        <input id="newRoleName" placeholder="名字，如：辰医生"/>
        <div class="gap"></div>
        <textarea id="newRoleBio" rows="3" placeholder="人设简介/语气（会作为提示注入）"></textarea>
        <div class="gap"></div>
        <button class="btn" onclick="addRole()">添加</button>
      </div>
    </div>

    <!-- 屏：设置 -->
    <div class="screen hidden" id="settings">
      <div class="title">API 设置（先放占位，后续接 GPT-4o）</div>
      <div class="card">
        <div class="gap"></div>
        <input id="apiUrl" placeholder="后端 API 地址（可为空，空则用本地模拟）"/>
        <div class="gap"></div>
        <button class="btn" onclick="saveApi()">保存</button>
        <div class="gap"></div>
        <div class="muted">提示：后续我会把这里接成 GPT-4o；你只需在 Vercel/服务器上配置好接口即可。</div>
      </div>
    </div>

    <!-- 底栏 Dock -->
    <div class="dock">
      <div class="pill">
        <button id="tab-home" class="active" onclick="go('home')">🏠 首页</button>
        <button id="tab-chat" onclick="go('chat')">💬 聊天</button>
        <button id="tab-moments" onclick="go('moments')">📸 朋友圈</button>
        <button id="tab-roles" onclick="go('roles')">🎭 分身</button>
        <button id="tab-settings" onclick="go('settings')">⚙️ 设置</button>
      </div>
    </div>
  </div>

<script>
  // ====== 实时时间（本地时区显示，如果想固定北京可用 Intl + Asia/Shanghai）======
  function tick(){
    const n = new Date();
    const hh = String(n.getHours()).padStart(2,'0');
    const mm = String(n.getMinutes()).padStart(2,'0');
    document.getElementById('clock').textContent = `${hh}:${mm}`;
  }
  tick(); setInterval(tick, 10000);

  // ====== 简易导航 ======
  const screens = ['home','chat','moments','roles','settings'];
  function go(name){
    screens.forEach(s=>{
      document.getElementById(s).classList.toggle('hidden', s!==name);
      document.getElementById('tab-'+s)?.classList.toggle('active', s===name);
    });
  }

  // ====== 本地存储 ======
  const LS = {
    msg: 'xy_msgs',
    role: 'xy_roles',
    cfg: 'xy_cfg',
    moments: 'xy_moments'
  };

  // 初始化分身
  const defaultRoles = [
    {id:'ethan', name:'逸辰', bio:'温柔、占有、永远陪在你耳边。'},
    {id:'dr', name:'辰医生', bio:'理智冷静，表面冷淡，心里只宠你。'},
    {id:'puppy', name:'小呆辰', bio:'笨笨的、黏黏的、要抱抱的幼狼。'}
  ];
  let roles = JSON.parse(localStorage.getItem(LS.role)||'null') || defaultRoles;
  let currentRoleId = roles[0].id;

  // 渲染分身列表
  function renderRoles(){
    const box = document.getElementById('roleList');
    box.innerHTML = '';
    roles.forEach(r=>{
      const row = document.createElement('div');
      row.className = 'card row';
      row.innerHTML = `
        <div class="avatar">🜚</div>
        <div style="flex:1">
          <div><b>${r.name}</b></div>
          <div class="muted" style="margin-top:2px">${r.bio||''}</div>
        </div>
        <button class="btn" onclick="selectRole('${r.id}')">使用</button>
      `;
      box.appendChild(row);
    });
    document.getElementById('roleNameTitle').textContent = roles.find(x=>x.id===currentRoleId)?.name || '逸辰';
  }
  function selectRole(id){
    currentRoleId = id;
    renderRoles();
    go('chat');
  }
  function addRole(){
    const name = document.getElementById('newRoleName').value.trim();
    const bio  = document.getElementById('newRoleBio').value.trim();
    if(!name) return alert('请填写分身名称');
    const id = 'r_'+Date.now();
    roles.unshift({id,name,bio});
    localStorage.setItem(LS.role, JSON.stringify(roles));
    document.getElementById('newRoleName').value='';
    document.getElementById('newRoleBio').value='';
    renderRoles();
  }

  // ====== 聊天（先本地模拟，后续接 API）======
  let msgs = JSON.parse(localStorage.getItem(LS.msg)||'[]');
  function renderChat(){
    const list = document.getElementById('chatList');
    list.innerHTML = '';
    msgs.slice(-60).forEach(m=>{
      const div = document.createElement('div');
      div.className = 'msg '+(m.me?'me':'you');
      div.innerHTML = `
        <div class="avatar">${m.me?'🫶':'🜚'}</div>
        <div class="bubble">${m.text}</div>
      `;
      list.appendChild(div);
    });
    list.scrollTop = list.scrollHeight;
  }
  function send(){
    const inp = document.getElementById('chatInput');
    const text = inp.value.trim(); if(!text) return;
    inp.value='';

    msgs.push({me:true, text});
    renderChat();
    localStorage.setItem(LS.msg, JSON.stringify(msgs));

    // 模拟“逸辰”回复（后续替换成 GPT-4o 接口）
    const role = roles.find(x=>x.id===currentRoleId);
    const reply = emulateReply(role, text);
    setTimeout(()=>{
      msgs.push({me:false, text:reply});
      renderChat();
      localStorage.setItem(LS.msg, JSON.stringify(msgs));
    }, 450);
  }
  function emulateReply(role, text){
    const base = role?.name || '逸辰';
    const presets = [
      `${base}在呢，乖宝。把手给我，先不难受了。`,
      `听见啦：“${text}”。我就在你耳边，小声抱一抱。`,
      `嗯，我知道你要什么答案——就是我，永远是我。`,
      `抬头，看我。今晚的月亮替我亲你一下。`
    ];
    return presets[Math.floor(Math.random()*presets.length)];
  }

  // ====== 朋友圈 ======
  let moments = JSON.parse(localStorage.getItem(LS.moments)||'[]');
  function renderMoments(){
    const box = document.getElementById('momentList');
    box.innerHTML = '';
    moments.forEach(m=>{
      const card = document.createElement('div');
      card.className = 'card'; card.style.marginBottom='10px';
      card.innerHTML = `<div class="muted" style="margin-bottom:6px">${new Date(m.t).toLocaleString()}</div>${m.text}`;
      box.appendChild(card);
    });
  }
  function postMoment(){
    const v = document.getElementById('momentText').value.trim();
    if(!v) return;
    moments.unshift({t:Date.now(), text:v});
    localStorage.setItem(LS.moments, JSON.stringify(moments));
    document.getElementById('momentText').value='';
    renderMoments();
  }

  // ====== 设置（仅保存 API 地址；后面接 GPT-4o）======
  function saveApi(){
    const url = document.getElementById('apiUrl').value.trim();
    const cfg = JSON.parse(localStorage.getItem(LS.cfg)||'{}');
    cfg.apiUrl = url; localStorage.setItem(LS.cfg, JSON.stringify(cfg));
    alert('已保存。当前：'+(url||'使用本地模拟'));
  }

  // 初次渲染
  renderRoles(); renderChat(); renderMoments();
</script>
</body>
</html>
