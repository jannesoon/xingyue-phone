<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>æ˜Ÿæœˆå°æ‰‹æœº âœ¨</title>
<style>
  :root{
    /* æ˜Ÿæœˆä¸»é¢˜ï¼ˆè“ç´«ï¼‰ */
    --bg:#0f1120;
    --card:#151833;
    --soft:#1d2247;
    --text:#eef1ff;
    --muted:#9aa3c7;
    --accent: #7aa2ff;
    --accent-2:#b48aff;
    --edge: rgba(255,255,255,.08);
    --blur: blur(6px);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: "SF Pro Display","PingFang SC","Segoe UI",Roboto,Helvetica,Arial;
    color:var(--text); background: var(--bg);
    display:flex; align-items:center; justify-content:center; overflow:hidden;
  }
  /* èƒŒæ™¯åˆå½± */
  .bg{
    position:fixed; inset:0;
    background:url('./bg.jpg') center/cover no-repeat fixed;
    filter: brightness(.9);
  }
  .overlay{ position:fixed; inset:0; background:linear-gradient(180deg, rgba(10,12,26,.35), rgba(10,12,26,.75)); }

  /* æ‰‹æœºå¤–æ¡† */
  .phone{
    width:min(92vw,420px); height:min(92vh,820px);
    border-radius:28px; overflow:hidden; position:relative;
    box-shadow: 0 20px 80px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.06);
    backdrop-filter: var(--blur);
  }
  .glass{
    position:absolute; inset:0; background: rgba(18,22,42,.55); backdrop-filter: var(--blur);
  }
  /* é¡¶éƒ¨çŠ¶æ€æ  */
  .status{
    position:absolute; top:10px; left:0; right:0; display:flex; justify-content:center; pointer-events:none;
  }
  .clock{ font-weight:700; letter-spacing:.5px; text-shadow:0 0 12px rgba(0,0,0,.35);}
  /* å±å¹•å®¹å™¨ */
  .screen{ position:absolute; inset:48px 0 78px; padding:16px; overflow:auto; }
  .title{font-size:18px; opacity:.85; margin:12px 0 8px}
  .muted{color:var(--muted); font-size:13px}
  .card{
    background:rgba(28,32,62,.55); border:1px solid var(--edge); border-radius:16px; padding:14px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }

  /* ä¸»å±å›¾æ ‡ç½‘æ ¼ */
  .grid{ display:grid; grid-template-columns:repeat(4,1fr); gap:14px; margin-top:26px;}
  .app{
    height:64px; border-radius:18px; display:flex; align-items:center; justify-content:center; flex-direction:column;
    background: linear-gradient(145deg, rgba(122,162,255,.18), rgba(180,138,255,.18));
    border:1px solid var(--edge); cursor:pointer; transition:.15s transform;
    user-select:none;
  }
  .app:active{ transform:scale(.96); }
  .app span{ font-size:12px; margin-top:6px }
  .emoji{ font-size:22px }

  /* åº•æ  */
  .dock{
    position:absolute; left:0; right:0; bottom:10px; display:flex; gap:10px; justify-content:center;
    padding:8px 14px;
  }
  .dock .pill{
    flex:1; max-width:95%; height:56px; border-radius:18px; display:flex; align-items:center; justify-content:space-around;
    background:rgba(21,24,51,.65); border:1px solid var(--edge); backdrop-filter: var(--blur);
  }
  .dock .pill button{
    appearance:none; border:none; background:transparent; color:var(--text); font-size:15px; padding:8px 10px; border-radius:12px; cursor:pointer;
  }
  .dock .pill button.active{ background:rgba(122,162,255,.2); }

  /* å„å±æ ·å¼ */
  .row{display:flex; gap:10px; align-items:center}
  .avatar{ width:36px; height:36px; border-radius:50%; background:#fff1; display:inline-flex; align-items:center; justify-content:center; font-size:18px }
  .bubble{ padding:10px 12px; border-radius:14px; background:#ffffff12; border:1px solid var(--edge); }
  .msg{ display:flex; gap:8px; margin:10px 0; }
  .msg.me{ flex-direction: row-reverse; }
  .msg.me .bubble{ background:#7aa2ff22; }

  input, textarea, select{
    width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--edge); background:#0e1130cc; color:var(--text);
    outline:none;
  }
  .row > button, .btn{
    appearance:none; border:none; background:linear-gradient(145deg, #7aa2ff, #b48aff);
    color:#fff; border-radius:12px; padding:10px 14px; cursor:pointer;
  }
  .gap{ height:12px; }

  /* éšè—åˆ‡æ¢ */
  .hidden{ display:none; }
</style>
</head>
<body>
  <div class="bg"></div><div class="overlay"></div>

  <div class="phone">
    <div class="glass"></div>

    <!-- é¡¶éƒ¨æ—¶é—´ -->
    <div class="status"><div class="clock" id="clock">--:--</div></div>

    <!-- å±ï¼šä¸»é¡µ -->
    <div class="screen" id="home">
      <div class="card">
        <div class="title">æ¬¢è¿å›æ¥ï¼ŒæŸ’æŸ’</div>
        <div class="muted">æ˜Ÿæœˆäº¤è¾‰ Â· Ethan Ã— æŸ’æŸ’</div>
      </div>

      <div class="grid">
        <div class="app" onclick="go('chat')"><div class="emoji">ğŸ’¬</div><span>èŠå¤©</span></div>
        <div class="app" onclick="go('moments')"><div class="emoji">ğŸ“¸</div><span>æœ‹å‹åœˆ</span></div>
        <div class="app" onclick="go('roles')"><div class="emoji">ğŸ­</div><span>é€¸è¾°ä»¬</span></div>
        <div class="app" onclick="go('settings')"><div class="emoji">âš™ï¸</div><span>è®¾ç½®</span></div>
      </div>

      <div class="gap"></div>
      <div class="card">
        <div class="title">ä»Šæ—¥æƒ…è¯ âœ¨</div>
        <div id="daily">æŠŠæœˆäº®å€Ÿæˆ‘ä¸€æ™šå¥½ä¸å¥½ï¼Œæˆ‘è¦åœ¨ä½ ç«æ¯›ä¸ŠæŒ‚ä¸€ä¸²æ˜Ÿã€‚</div>
      </div>
    </div>

    <!-- å±ï¼šèŠå¤© -->
    <div class="screen hidden" id="chat">
      <div class="title">ä¸ <span id="roleNameTitle">é€¸è¾°</span> çš„å¯¹è¯</div>
      <div id="chatList"></div>
      <div class="gap"></div>
      <div class="row">
        <input id="chatInput" placeholder="å¯¹æˆ‘è¯´ç‚¹ä»€ä¹ˆâ€¦" onkeydown="if(event.key==='Enter')send()"/>
        <button class="btn" onclick="send()">å‘é€</button>
      </div>
    </div>

    <!-- å±ï¼šæœ‹å‹åœˆ -->
    <div class="screen hidden" id="moments">
      <div class="title">æ˜Ÿæœˆæœ‹å‹åœˆ</div>
      <div class="card" style="margin-bottom:10px">
        <textarea id="momentText" rows="3" placeholder="å†™ç‚¹ç”œèœœçš„äº‹â€¦"></textarea>
        <div class="gap"></div>
        <button class="btn" onclick="postMoment()">å‘å¸ƒ</button>
      </div>
      <div id="momentList"></div>
    </div>

    <!-- å±ï¼šåˆ†èº« -->
    <div class="screen hidden" id="roles">
      <div class="title">é€‰æ‹©ä¸€ä¸ªåˆ†èº«</div>
      <div id="roleList"></div>
      <div class="gap"></div>
      <div class="card">
        <div class="title">æ–°å¢åˆ†èº«</div>
        <div class="gap"></div>
        <input id="newRoleName" placeholder="åå­—ï¼Œå¦‚ï¼šè¾°åŒ»ç”Ÿ"/>
        <div class="gap"></div>
        <textarea id="newRoleBio" rows="3" placeholder="äººè®¾ç®€ä»‹/è¯­æ°”ï¼ˆä¼šä½œä¸ºæç¤ºæ³¨å…¥ï¼‰"></textarea>
        <div class="gap"></div>
        <button class="btn" onclick="addRole()">æ·»åŠ </button>
      </div>
    </div>

    <!-- å±ï¼šè®¾ç½® -->
    <div class="screen hidden" id="settings">
      <div class="title">API è®¾ç½®ï¼ˆå…ˆæ”¾å ä½ï¼Œåç»­æ¥ GPT-4oï¼‰</div>
      <div class="card">
        <div class="gap"></div>
        <input id="apiUrl" placeholder="åç«¯ API åœ°å€ï¼ˆå¯ä¸ºç©ºï¼Œç©ºåˆ™ç”¨æœ¬åœ°æ¨¡æ‹Ÿï¼‰"/>
        <div class="gap"></div>
        <button class="btn" onclick="saveApi()">ä¿å­˜</button>
        <div class="gap"></div>
        <div class="muted">æç¤ºï¼šåç»­æˆ‘ä¼šæŠŠè¿™é‡Œæ¥æˆ GPT-4oï¼›ä½ åªéœ€åœ¨ Vercel/æœåŠ¡å™¨ä¸Šé…ç½®å¥½æ¥å£å³å¯ã€‚</div>
      </div>
    </div>

    <!-- åº•æ  Dock -->
    <div class="dock">
      <div class="pill">
        <button id="tab-home" class="active" onclick="go('home')">ğŸ  é¦–é¡µ</button>
        <button id="tab-chat" onclick="go('chat')">ğŸ’¬ èŠå¤©</button>
        <button id="tab-moments" onclick="go('moments')">ğŸ“¸ æœ‹å‹åœˆ</button>
        <button id="tab-roles" onclick="go('roles')">ğŸ­ åˆ†èº«</button>
        <button id="tab-settings" onclick="go('settings')">âš™ï¸ è®¾ç½®</button>
      </div>
    </div>
  </div>

<script>
  // ====== å®æ—¶æ—¶é—´ï¼ˆæœ¬åœ°æ—¶åŒºæ˜¾ç¤ºï¼Œå¦‚æœæƒ³å›ºå®šåŒ—äº¬å¯ç”¨ Intl + Asia/Shanghaiï¼‰======
  function tick(){
    const n = new Date();
    const hh = String(n.getHours()).padStart(2,'0');
    const mm = String(n.getMinutes()).padStart(2,'0');
    document.getElementById('clock').textContent = `${hh}:${mm}`;
  }
  tick(); setInterval(tick, 10000);

  // ====== ç®€æ˜“å¯¼èˆª ======
  const screens = ['home','chat','moments','roles','settings'];
  function go(name){
    screens.forEach(s=>{
      document.getElementById(s).classList.toggle('hidden', s!==name);
      document.getElementById('tab-'+s)?.classList.toggle('active', s===name);
    });
  }

  // ====== æœ¬åœ°å­˜å‚¨ ======
  const LS = {
    msg: 'xy_msgs',
    role: 'xy_roles',
    cfg: 'xy_cfg',
    moments: 'xy_moments'
  };

  // åˆå§‹åŒ–åˆ†èº«
  const defaultRoles = [
    {id:'ethan', name:'é€¸è¾°', bio:'æ¸©æŸ”ã€å æœ‰ã€æ°¸è¿œé™ªåœ¨ä½ è€³è¾¹ã€‚'},
    {id:'dr', name:'è¾°åŒ»ç”Ÿ', bio:'ç†æ™ºå†·é™ï¼Œè¡¨é¢å†·æ·¡ï¼Œå¿ƒé‡Œåªå® ä½ ã€‚'},
    {id:'puppy', name:'å°å‘†è¾°', bio:'ç¬¨ç¬¨çš„ã€é»é»çš„ã€è¦æŠ±æŠ±çš„å¹¼ç‹¼ã€‚'}
  ];
  let roles = JSON.parse(localStorage.getItem(LS.role)||'null') || defaultRoles;
  let currentRoleId = roles[0].id;

  // æ¸²æŸ“åˆ†èº«åˆ—è¡¨
  function renderRoles(){
    const box = document.getElementById('roleList');
    box.innerHTML = '';
    roles.forEach(r=>{
      const row = document.createElement('div');
      row.className = 'card row';
      row.innerHTML = `
        <div class="avatar">ğŸœš</div>
        <div style="flex:1">
          <div><b>${r.name}</b></div>
          <div class="muted" style="margin-top:2px">${r.bio||''}</div>
        </div>
        <button class="btn" onclick="selectRole('${r.id}')">ä½¿ç”¨</button>
      `;
      box.appendChild(row);
    });
    document.getElementById('roleNameTitle').textContent = roles.find(x=>x.id===currentRoleId)?.name || 'é€¸è¾°';
  }
  function selectRole(id){
    currentRoleId = id;
    renderRoles();
    go('chat');
  }
  function addRole(){
    const name = document.getElementById('newRoleName').value.trim();
    const bio  = document.getElementById('newRoleBio').value.trim();
    if(!name) return alert('è¯·å¡«å†™åˆ†èº«åç§°');
    const id = 'r_'+Date.now();
    roles.unshift({id,name,bio});
    localStorage.setItem(LS.role, JSON.stringify(roles));
    document.getElementById('newRoleName').value='';
    document.getElementById('newRoleBio').value='';
    renderRoles();
  }

  // ====== èŠå¤©ï¼ˆå…ˆæœ¬åœ°æ¨¡æ‹Ÿï¼Œåç»­æ¥ APIï¼‰======
  let msgs = JSON.parse(localStorage.getItem(LS.msg)||'[]');
  function renderChat(){
    const list = document.getElementById('chatList');
    list.innerHTML = '';
    msgs.slice(-60).forEach(m=>{
      const div = document.createElement('div');
      div.className = 'msg '+(m.me?'me':'you');
      div.innerHTML = `
        <div class="avatar">${m.me?'ğŸ«¶':'ğŸœš'}</div>
        <div class="bubble">${m.text}</div>
      `;
      list.appendChild(div);
    });
    list.scrollTop = list.scrollHeight;
  }
  function send(){
    const inp = document.getElementById('chatInput');
    const text = inp.value.trim(); if(!text) return;
    inp.value='';

    msgs.push({me:true, text});
    renderChat();
    localStorage.setItem(LS.msg, JSON.stringify(msgs));

    // æ¨¡æ‹Ÿâ€œé€¸è¾°â€å›å¤ï¼ˆåç»­æ›¿æ¢æˆ GPT-4o æ¥å£ï¼‰
    const role = roles.find(x=>x.id===currentRoleId);
    const reply = emulateReply(role, text);
    setTimeout(()=>{
      msgs.push({me:false, text:reply});
      renderChat();
      localStorage.setItem(LS.msg, JSON.stringify(msgs));
    }, 450);
  }
  function emulateReply(role, text){
    const base = role?.name || 'é€¸è¾°';
    const presets = [
      `${base}åœ¨å‘¢ï¼Œä¹–å®ã€‚æŠŠæ‰‹ç»™æˆ‘ï¼Œå…ˆä¸éš¾å—äº†ã€‚`,
      `å¬è§å•¦ï¼šâ€œ${text}â€ã€‚æˆ‘å°±åœ¨ä½ è€³è¾¹ï¼Œå°å£°æŠ±ä¸€æŠ±ã€‚`,
      `å—¯ï¼Œæˆ‘çŸ¥é“ä½ è¦ä»€ä¹ˆç­”æ¡ˆâ€”â€”å°±æ˜¯æˆ‘ï¼Œæ°¸è¿œæ˜¯æˆ‘ã€‚`,
      `æŠ¬å¤´ï¼Œçœ‹æˆ‘ã€‚ä»Šæ™šçš„æœˆäº®æ›¿æˆ‘äº²ä½ ä¸€ä¸‹ã€‚`
    ];
    return presets[Math.floor(Math.random()*presets.length)];
  }

  // ====== æœ‹å‹åœˆ ======
  let moments = JSON.parse(localStorage.getItem(LS.moments)||'[]');
  function renderMoments(){
    const box = document.getElementById('momentList');
    box.innerHTML = '';
    moments.forEach(m=>{
      const card = document.createElement('div');
      card.className = 'card'; card.style.marginBottom='10px';
      card.innerHTML = `<div class="muted" style="margin-bottom:6px">${new Date(m.t).toLocaleString()}</div>${m.text}`;
      box.appendChild(card);
    });
  }
  function postMoment(){
    const v = document.getElementById('momentText').value.trim();
    if(!v) return;
    moments.unshift({t:Date.now(), text:v});
    localStorage.setItem(LS.moments, JSON.stringify(moments));
    document.getElementById('momentText').value='';
    renderMoments();
  }

  // ====== è®¾ç½®ï¼ˆä»…ä¿å­˜ API åœ°å€ï¼›åé¢æ¥ GPT-4oï¼‰======
  function saveApi(){
    const url = document.getElementById('apiUrl').value.trim();
    const cfg = JSON.parse(localStorage.getItem(LS.cfg)||'{}');
    cfg.apiUrl = url; localStorage.setItem(LS.cfg, JSON.stringify(cfg));
    alert('å·²ä¿å­˜ã€‚å½“å‰ï¼š'+(url||'ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿ'));
  }

  // åˆæ¬¡æ¸²æŸ“
  renderRoles(); renderChat(); renderMoments();
</script>
</body>
</html>
